---
- name: "Process keys"
  include_tasks: "{{ pjroot }}/playbooks/common/processkeys.yaml"

- name: Make sure that profiles holding directory exists
  file:
    path: "{{ pjroot }}/vars/profiles"
    state: "directory"
    mode: 0775

- name: Create profiles
  template:
    src: "{{ pjroot }}/playbooks/ops/profilegen/templates/{{ item.name }}"
    dest: "{{ pjroot }}/vars/profiles/{{ item.target }}"
  with_items:
    - "{{ {'name': 'pyprofile.j2', 'target': CHANNEL_NAME+'_network.json'} }}"
    - "{{ {'name': 'goprofile.j2', 'target': CHANNEL_NAME+'_connection.json'} }}"
    - "{{ {'name': 'goprofileyaml.j2', 'target': CHANNEL_NAME+'_connection.yaml'} }}"
    - "{{ {'name': 'endpoints.j2', 'target': 'endpoints.yaml'} }}"
    - "{{ {'name': 'vscodenodefile.j2', 'target': 'vscodenodefile.json'} }}"
