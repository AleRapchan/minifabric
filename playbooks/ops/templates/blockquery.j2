#!/bin/bash
# Script to instantiate chaincode
cp $FABRIC_CFG_PATH/core.yaml /vars/core.yaml
cd /vars
export FABRIC_CFG_PATH=/vars

{% include "envsetting.j2" %}
peer channel fetch {{ BLOCK_NUMBER }} -o $ORDERER_ADDRESS \
  --cafile $ORDERER_TLS_CA -c {{ CHANNEL_NAME }} --tls

configtxlator proto_decode --input {{ CHANNEL_NAME }}_{{ BLOCK_NUMBER }}.block \
  --type common.Block | jq -f run/blockquery.jq \
  > {{ CHANNEL_NAME }}_{{ BLOCK_NUMBER }}_txs.json
